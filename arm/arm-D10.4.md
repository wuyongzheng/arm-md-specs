## D10.4 Tag checking

DXPMJF

All statements in this section require implementation of FEAT\_MTE2.

## D10.4.1 Tag Checked memory accesses

RCPKNZ

AMemory Read or Write Effect generated by an instruction is one of:

- Tag Unchecked .

- Tag Checked .

RDRGYL AMemory Read or Write Effect is Tag Unchecked due to any of the following, otherwise it is Tag Checked :

- The Memory Effect is an Explicit Memory Effect, and is:

- To an Untagged memory region.

- By an instruction that explicitly loads or stores an Allocation Tag .

- Due to a cache maintenance operation by V A other than DC ZV A.

- By a prefetch instruction.

- Due to a load or store relative to VNCR\_EL2 if FEAT\_NV2 is implemented.

- Generated by the Trace Buffer Unit if FEAT\_TRBE is implemented.

- Generated by the Statistical Profiling Unit if SPE is implemented.

- Afetch of GPT information if FEAT\_RME is implemented.

- AGuarded Control Stack data access, if FEAT\_GCS is implemented.

- AMemory Read Effect generated by an instruction for which Store-only Tag checking is enabled, if FEAT\_MTE\_STORE\_ONLY is implemented.

- By an instruction that uses any of the following addressing modes:

- Abase register only, where SP is the base register.

- Abase register plus immediate offset addressing form, where SP is the base register.

- Literal (PC-relative).

- The Memory Effect is not an Explicit Memory Effect.

- The Effective value of PSTATE.TCO is 1.

- Logical Address Tagging is disabled for the V A range being accessed. See Logical Address Tagging for more information.

- Irrespective of whether the stage 1 address translation for the ELx translation regime is enabled or not, the Logical Address Tag has the value 0b0000 and either of the following conditions apply:

- If the stage 1 translation supports a single V A range, TCR\_ELx.TCMA is 1.

- If the stage 1 translation supports two V A ranges, TCR\_ELx.TCMA0 is 1 and the access is to the lower address range.

- Irrespective of whether the stage 1 address translation for the ELx translation regime is enabled or not, when all of the following conditions apply:

- The Logical Address Tag has the value 0b1111 .

- If the stage 1 translation supports two V A ranges, TCR\_ELx.TCMA1 is 1 and the access is to the upper address range.

RMCGNZ For the purpose of determining if a memory access is Tag Checked , an unprivileged access generated by an unprivileged memory access instruction is treated as if the access is at EL0.

RKVCNS When executing a Tag Checked Store-Exclusive instruction, that if Tag Unchecked

would not perform the store, and would return a status value of 1, it is CONSTRAINED UNPREDICTABLE whether the instruction generates either:

- A Tag Checked memory access.

- A Tag Unchecked memory access.

RBGGMD

If FEAT\_SME is implemented, it is IMPLEMENTATION DEFINED whether memory accesses due to the following instructions are Tag Checked :

- SME, SVE, and SIMD&amp;FP loads and stores that are executed when the PE is in Streaming SVE mode.

- SMELDR(array vector) and STR (array vector).

- SME2 LDR (table) and STR (table).

| R HRQCL   | Memory accesses in Debug state follow the same rules as memory accesses in Non-Debug state for the purposes of determining if a memory access is Tag Checked or Tag Unchecked .                                  |
|-----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| I PVCHY   | Any MMUfaults generated by a read of an Allocation Tag for a Tag Checked memory access are not ordered with respect to any MMUfaults generated by the memory access.                                             |
| R ZHPVP   | If FEAT_MTE_STORE_ONLY is implemented, Store-only Tag Checking can be configured by the SCTLR_ELx{TCSO, TSCO0} controls.                                                                                         |
| R MNHCZ   | For a Compare and swap instruction, if the compare fails, a Memory Write Effect by the instruction is permitted to be treated as Tag Unchecked .                                                                 |
| R MLCNN   | If a Tag Check Fault is configured to have no effect on a PE due to SCTLR_ELx.{TCF, TCF0}, whether a Tag Checked access is observed in performance monitors and statistical profiling is IMPLEMENTATION DEFINED. |

## D10.4.2 Tag Check operations

RFDNHC

RQTQDK

RBJWLM

RVJMHZ

When a Tag Checked memory access to a memory region occurs:

- If the memory region is Tagged , a Tag Check operation is performed.
- If the memory region is Canonically Tagged , a Canonical Tag Check operation is performed.
- If the memory region is Untagged , no Tag Checking occurs.

Bits [59:56] of a 64-bit V A used for a memory access are a Logical Address Tag .

For more information, see Logical Address Tagging.

A Tag Check operation at a V A:

- Performs an implicit read of an Allocation Tag at the V A aligned to the Tag Granule .
- Compares the Allocation Tag with the Logical Address Tag .
- Generates a Tag Check Fault if the two tags are not equal.

A Canonical Tag Check operation at a V A generates a Tag Check Fault if:

- For a translation regime where stage 1 translation supports two V A ranges the Logical Address Tag does not have the value:
- -0b0000 , if the V A, bit[55], is 0.
- -0b1111 , if the V A, bit[55], is 1.
- For a translation regime where stage 1 translation supports a single V A range, the Logical Address Tag does not have the value 0b0000 .