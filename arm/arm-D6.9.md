## D6.9 Trace in Debug state

- RWYHRT If the trace unit is disabled, then a TSB CSYNC executed in Debug state is not Microarchitecturally-finished before all of the following are true:
- All trace operations tA generated by instructions A in program order before the PE entered Debug state are Microarchitecturally-finished.
- All trace operations tS generated by Speculative instructions S that are not in speculative execution order after the entry to Debug state are Microarchitecturally-finished.
- All trace operations tR generated by the trace unit are Microarchitecturally-finished.
- The trace unit enters a state where the trace unit does not generate further trace operations and does not signal a Detected Trigger . The trace unit remains in this state while the PE is in Debug state.
- If a trace unit flush is initiated by a Trigger Event before the TSB CSYNC is Microarchitecturally-finished, the trace unit flush is complete, all trace operations the Trace Buffer Unit accepts before the trace unit flush completes are Microarchitecturally-finished, and any indirect writes made by the Trace Buffer Unit on completion of the trace unit flush have been performed.

These trace operations are synchronized by the TSB CSYNC .

- RXQVZW Adirect write W2 to a System register made by an instruction B is Coherence-after an indirect read or indirect write RW1 of the same System register made by a trace operation tA for a traced instruction A if all of the following are true:
- Ais executed in program order before the PE entered Debug state.
- Bis executed in program order after a Trace synchronization barrier TSB.
- TSB was executed in Debug state when the trace unit was disabled.
- IVHGVC RXQVZW emerges from the requirement in RWYHRT for the trace operations to be Microarchitecturally-finished by the TSB CSYNC operation.

Trace Synchronization event and Self-hosted trace extension synchronization rules define further rules for the operation of TSB CSYNC .

- RMPXXN A DSB with required access types of reads and write is executed after a TSB CSYNC operation executed in Debug state, then in addition to the requirements in this manual, the DSB does not complete until all explicit memory accesses of the required access type made by the trace operations synchronized by the TSB CSYNC are Complete for the set of observers in the required Shareability domain.