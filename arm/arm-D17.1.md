## D17.1 About the Statistical Profiling Extension

DNLVYX

When the Statistical Profiling Extension is implemented, the PE includes a Statistical Profiling Unit (SPU).

IWKZFN

When profiling is enabled and not stopped, the SPU does the following:

1. Chooses an operation from a sample population, that can be restricted by Exception level, at a programmable interval that might have some random, or pseudorandom, perturbation.
2. Takes a trace of the sampled operation. This includes the PC, events, timings, and data addresses, related to the sampled operation. This is the profiling operation.
3. If defined, filters out potential sample records generated by the profiling operation by reference to any or all of the following:
- a. The type of operation.
- b. Events.
- c. Latency.
- d. Data source, for loads.
4. Creates a record that contains the traced information. Sample records that meet the criteria of the filter are written to and stored in a memory buffer. These sample records can be processed by software when the memory buffer is full.

After creating the record for the sampled operation, the SPU writes a record to memory sequentially in increasing address order. That is, for each byte in the record, the SPU:

1. If required, translates the current write pointer virtual address to a physical address.
2. If permitted, writes the byte of record data to the write address.
3. If profiling is not stopped, increments the current write pointer.

Profiling Buffer management events are processed as part of this loop. Implementations compliant with the architecture conform with the described behavior of the SPU.

Except where the architecture specifies differently, the programmer-visible behavior of an implementation that is compliant with this specification is the same as a simple sequential model. Although records appear to be written sequentially, the architecture does not require that a record is written sequentially by the SPU.

If FEAT\_PMUv3 is implemented, then the SPU also generates PMU events:

- For each operation in the sample population.
- When an operation is chosen for sampling.
- When a sample record is created.

For more information, see PMU Event Descriptions.

## D17.1.1 Non-invasive behavior

Statistical Profiling is a non-invasive debug operation:

- While profiling is enabled, the operation and performance of the processing element (PE) must not be significantly impacted between sampled operations, that is, other than for writing out sample records and processing Profiling Buffer management events.
- The performance of the sampled operation and the performance of the PE in general must not be significantly impacted. The sample records are not written to memory until after the sampled operation has finished execution. However, this does not apply if the sample records are physical addresses for data access operations. In this case, the impact is IMPLEMENTATION DEFINED.
- The profiling operation to write sample records must not be excessively impactful on the performance of the sampled operation or the performance of the PE generally.

## D17.1.2 Multithreaded implementations

In a multithreaded implementation:

- Statistical Profiling is implemented per-thread.
- The sample interval counter counts only operations for the thread that is being profiled.

RJMMZP

IHXPSC

- Latency and other cycle counters count each cycle for the PE for which the thread was active and could issue an operation.

The architecture does not define features for inter-thread profiling and does not support sharing the Profiling Buffer between threads.

Note

An implementation is described as multithreaded when the lowest level of affinity consists of logical processors that are implemented using a multithreading type approach. That is, the performance of processors at the lowest affinity level is interdependent.