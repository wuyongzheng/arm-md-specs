## D2.3 The debug exception enable controls

The enable controls for each debug exception are as follows:

## Breakpoint Instruction exceptions

None. Breakpoint Instruction exceptions are always enabled.

## Breakpoint exceptions

MDSCR\_EL1.MDE, plus an enable control for each breakpoint, DBGBCR&lt;n&gt;\_EL1.E.

If more than 16 breakpoints are implemented, then extended breakpoint and watchpoint enable controls are implemented for the additional breakpoints, MDCR\_EL3.EBWE, MDCR\_EL2.EBWE, MDSCR\_EL1.EMBWE, and EDSCR2.EHBWE.

## Watchpoint exceptions

MDSCR\_EL1.MDE, plus an enable control for each watchpoint, DBGWCR&lt;n&gt;\_EL1.E.

If more than 16 watchpoints are implemented, then extended breakpoint and watchpoint enable controls are implemented for the additional watchpoints, MDCR\_EL3.EBWE, MDCR\_EL2.EBWE, MDSCR\_EL1.EMBWE, and EDSCR2.EHBWE.

## Vector Catch exceptions

MDSCR\_EL1.MDE.

## Software Step exceptions

MDSCR\_EL1.SS.

In addition, for all debug exceptions other than Breakpoint Instruction exceptions, software must configure the controls that enable debug exceptions from the current Exception level and Security state. See Enabling debug exceptions from the current Exception level and Security state.

The PE cannot take a debug exception if debug exceptions are disabled from either the current Exception level or the current Security state.

Breakpoint Instruction exceptions are always enabled from the current Exception level and Security state.

## D2.3.1 Enabling debug exceptions from the current Exception level and Security state

Debug exceptions are enabled from the current Exception level, where ELD is the Exception level defined in Routing debug exceptions, as follows:

- When executing at any Exception level that is higher than ELD:
- -Breakpoint Instruction exceptions are enabled.
- -All other debug exceptions are disabled.
- When executing at ELD:
- -Breakpoint Instruction exceptions are enabled.
- -All other debug exceptions are disabled if either of the following is true:
- -The Local (kernel) Debug Enable bit, MDSCR\_EL1.KDE, is 0.
- -The Debug exception mask bit, PSTATE.D, is 1.

This means that a debugger must explicitly enable these debug exceptions from ELD by setting MDSCR\_EL1.KDE to 1 and PSTATE.D to 0.

- When executing at EL1, ELD is EL2, and FEAT\_NV2 is implemented:
- -Watchpoint debug exceptions generated by a System register access converted to a memory access because the Effective value of HCR\_EL2.NV2 is 1 are disabled if MDSCR\_EL1.KDE is 0 and enabled if MDSCR\_EL1.KDE is 1. The value of PSTATE.D is ignored.
- -All other debug exceptions are enabled.
- Otherwise all debug exceptions are enabled.

Table D2-5 shows when debug exceptions are enabled from the current Security state.

If EL3 and Secure state are implemented, software executing at EL3 can set the Secure Debug Disable bit, MDCR\_EL3.SDD, to 1 to disable all debug exceptions taken from AArch64 Secure state other than Breakpoint Instruction exceptions.

The A-profile architecture does not support disabling debug exceptions in Non-secure state and, if FEAT\_RME is implemented, Realm state.

Table D2-5 Whether debug exceptions are enabled from the current Security state

| Current Security state   | Breakpoint Instruction exceptions   | All other debug exceptions                                               |
|--------------------------|-------------------------------------|--------------------------------------------------------------------------|
| Non-secure               | Enabled                             | Enabled                                                                  |
| Secure                   | Enabled                             | Disabled if the Effective value of MDCR_EL3.SDD is 1. Otherwise enabled. |
| Realm                    | Enabled                             | Enabled                                                                  |
| Root                     | Enabled                             | Disabled                                                                 |

If EL3 is not implemented and the implementation is a Secure state only implementation, or Secure state is not implemented, then the Effective value of MDCR\_EL3.SDD is 0.

## D2.3.2 Pseudocode description of enabling debug exceptions

AArch64.GenerateDebugExceptions() determines whether debug exceptions other than Breakpoint Instruction exceptions are enabled from the current Exception level and Security state.

AArch64.GenerateDebugExceptionsFrom() determines whether debug exceptions other than Breakpoint Instruction exceptions are enabled from the specified Exception level and Security state.

These functions are described in A-profile Architecture Pseudocode.