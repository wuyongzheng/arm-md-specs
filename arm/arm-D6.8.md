## D6.8 Trace of Speculative execution

| I ZGCVG   | In the standard model of execution for an instruction, instructions are executed as Speculative operations and then later become one of the following:                                                                                                                                                                                                                                                                     |
|-----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|           | • Resolved. These instructions will then proceed to Complete. • Canceled.                                                                                                                                                                                                                                                                                                                                                  |
|           | Atrace unit might generate trace for Speculative instructions before they are Resolved or Canceled, and this trace can be written to memory. This means that, as well as indirectly reading System registers or memory, a trace operation t S for a Speculative instruction S might perform any of the following:                                                                                                          |
|           | • Indirectly write to System registers.                                                                                                                                                                                                                                                                                                                                                                                    |
|           | • Write to memory.                                                                                                                                                                                                                                                                                                                                                                                                         |
|           | This sets trace operations apart from the normal operation of instructions, as the Arm architecture prohibits, for example, a Canceled instruction from updating a System register or memory. (Performance Monitors and Statistical Profiling can also cause speculative updates of System registers and memory.)                                                                                                          |
| I HBYGS   | The preceding rules deal with the ordering of trace operations for Resolved (and ultimately Complete) instructions, and the requirements for synchronization based on the position of those instructions in the program order of the Execution stream.                                                                                                                                                                     |
|           | This section extends the rules to cover Speculative instructions that are later Canceled, and for trace operations generated by ETE Resources. Because these trace operations are not generated by instructions that Complete, they cannot be determined to be in program order with respect to architecturally Complete instructions.                                                                                     |
| R FBFRS   | ASpeculative instruction S is in speculative execution-order after an instruction Aif S will be in program order after Aif S is Resolved, even if S is subsequently Canceled.                                                                                                                                                                                                                                              |
| I VFLVX   | For example, a Speculative instruction S is in speculative execution-order after a Resolved instruction Aif either of the following are true:                                                                                                                                                                                                                                                                              |
|           | • The branch predictor mispredicted Aand, had the prediction been correct, S would be in program order after A. Branch predictor means any structure that causes the PE to execute Speculative instructions. This includes, for example, branch history buffers, branch target caches, and instruction trace caches. It is not limited to structures that predict only the direction and/or target of branch instructions. |
| I KTCMP   | Speculative execution-order does not provide a complete ordering. Apair of Speculative instructions Aand Bmight not be ordered with respect to each other. For example, if Aand Bare respectively the result of different incorrect predictions by the branch predictor. However, each Speculative instruction is in speculative execution-order after at least one Resolved instruction.                                  |
| I VBBVY   | The architecture requires that instructions that generate Context synchronization events do not appear to be executed speculatively.                                                                                                                                                                                                                                                                                       |
| R HCVVS   | Atrace operation t S generated by a Speculative instruction S that is in speculative execution-order after a Resolved instruction Ainherits the synchronization requirements for a trace operation generated by A, even if no trace operation is generated by A, provided that one of the following applies:                                                                                                               |
|           | • The requirement is that Ais executed in program-order after CSE, and S is in speculative execution-order after CSE.                                                                                                                                                                                                                                                                                                      |
|           | • The requirement is that either Ais executed in program-order before CSE or Ais CSE, and S is not in speculative execution-order after CSE.                                                                                                                                                                                                                                                                               |