## D10.3 Memory region tagging types

RSWGZW

RJJRJP

RXNJXP

A memory region tagging type is one of the following:

- Tagged if FEAT\_MTE2 is implemented.
- Canonically Tagged if FEAT\_MTE\_CANONICAL\_TAGS is implemented.
- Untagged .

The memory region tagging type for a memory access is:

- Tagged

if all of the following are true:

- -FEAT\_MTE2 is implemented.
- -Allocation Tag Access is enabled for the memory region. For more information, see Allocation Tag Access controls.
- -The stage 1 attributes define the Tagged attribute.
- -The combined effects of stage 1 and stage 2 translations define the memory attributes as Normal memory, Inner and Outer Write-Back, Non-Transient, Read-Allocate and Write-Allocate.
- Otherwise it is Canonically Tagged if all of the following are true:
- -FEAT\_MTE\_CANONICAL\_TAGS is implemented.
- -Allocation Tag Access is enabled for the memory access.
- -Canonical Tagging is enabled for the memory region.
- -The stage 1 attributes do not define the Tagged attribute.
- Otherwise it is CONSTRAINED UNPREDICTABLE if it is Canonically Tagged or Untagged if all of the following are true:
- -FEAT\_MTE\_CANONICAL\_TAGS is implemented.
- -Canonical Tagging is enabled for the memory region.
- -The stage 1 attributes define the Tagged attribute.
- -The combined effects of stage 1 and stage 2 translations do not define the memory attributes as Normal memory, Inner and Outer Write-Back, Non-Transient, Read-Allocate and Write-Allocate.
- Otherwise it is Untagged .

If FEAT\_MTE\_CANONICAL\_TAGS is implemented, Canonical Tagging is configured by the following controls:

- If the stage 1 translation supports two V A ranges, TCR\_ELx.MTX n .
- If the stage 1 translation supports a single V A range, TCR\_ELx.MTX.

RGCCBJ For the purpose of determining the memory region tagging type for a memory region, an unprivileged access generated by an unprivileged memory access instruction is treated as if the access is at EL0.

## RYSLYC If the

memory region tagging type for a memory region is:

- Tagged , then all of the following are true:
- -For the EL1&amp;0 translation regime:
- -If HCR\_EL2.DC is 0 and the stage 1 translation assigns the Non-shareable attribute, then it is IMPLEMENTATION DEFINED whether the memory region is treated as Tagged or Untagged.
- -If the combined stage 1 and stage 2 Shareability attributes are Non-shareable, then it is IMPLEMENTATION DEFINED whether the memory region is treated as Tagged or Untagged.
- -For a translation regime other than EL1&amp;0:
- -If the stage 1 translation assigns the Non-shareable attribute, then it is IMPLEMENTATION DEFINED whether the memory region is treated as Tagged or Untagged.
- -If SCTLR\_ELx.C is 0 for a memory access, it is CONSTRAINED UNPREDICTABLE whether the memory region is treated as Tagged or Untagged .
- Canonically Tagged , then all of the following are true:
- -For the EL1&amp;0 translation regime:
- -If HCR\_EL2.DC is 0 and the stage 1 translation assigns the Non-shareable attribute, then it is IMPLEMENTATION DEFINED whether the memory region is treated as Canonically tagged or Untagged.
- -If the combined stage 1 and stage 2 Shareability attributes are Non-shareable, then it is IMPLEMENTATION DEFINED whether the memory region is treated as Canonically tagged or Untagged.

IQZXCY

RWNMML

RVBFYY

- -For a translation regime other than EL1&amp;0:
- -If the stage 1 translation assigns the Non-shareable attribute, then it is IMPLEMENTATION DEFINED whether the memory region is treated as Canonically tagged or Untagged.
- -SCTLR\_ELx.C has no effect on whether the memory region is treated as Canonically Tagged .

To ensure consistent behavior, software can set SCTLR\_ELx.ATA to 0 when SCTLR\_ELx.C is 0.

For a read of an Allocation Tag all of the following are true:

- If the read is from an Untagged memory region:
- -The read returns the value 0b0000 .
- -All effects of the access other than the read of the Allocation Tag from memory occur.
- -The read is permitted to generate an External abort if a read of data at the same V A would generate an External abort.
- If the read is from a Canonically Tagged memory region:
- -For a translation regime where stage 1 translation supports two V A ranges, the read returns the value:
- -0b0000 , if the V A, bit[55], is 0.
- -0b1111 , if the V A, bit[55], is 1.
- -For a translation regime where stage 1 translation supports a single V A range, the read returns the value 0b0000 .
- -All effects of the access other than the read of the Allocation Tag from memory occur.
- -The read is permitted to generate an External abort if a read of data at the same V A would generate an External abort.

For a write of an Allocation Tag all of the following are true:

- If the write is to an Untagged memory region:
- -The write does not modify the Allocation Tag in memory.
- -All effects of the access other than the write of the Allocation Tag to memory occur.
- If the write is to a Canonically Tagged memory region, the write generates a stage 1 Permission fault with ESR\_ELx.TnD set to 1, if the stage 1 of translation is enabled.

## D10.3.1 Interactions with Device memory

INLXDF

RWHXBY

RJMXVK

If a memory region has the Device memory type, the memory region is not Tagged .

Awrite of data by an STZGM instruction to any type of Device memory is CONSTRAINED UNPREDICTABLE between:

- Zeroing the data at the specified locations.
- Generating an Alignment Fault determined by the memory type.

For a DC GVA instruction to any type of Device memory it is CONSTRAINED UNPREDICTABLE whether the instruction generates an Alignment Fault determined by the memory type.