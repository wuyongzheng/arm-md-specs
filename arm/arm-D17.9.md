## D17.9 Synchronization and Statistical Profiling

IRRBSZ

The profiling operation of the SPU:

- Makes indirect reads and indirect writes of System registers.

- Writes to memory.

- Makes further indirect writes to PMBPTR\_EL1 as a result of an External abort on a write to memory.

IWZSLB

The indirect reads of the PMSCR\_EL1.{E1SPE, E0SPE} and PMSCR\_EL2.{E2SPE, E0HSPE} controls when determining whether to select an operation for profiling are treated as indirect reads made by the instruction being executed, and subject to the standard requirements for synchronization.

Otherwise, although the profiling operation is generated by a sampled operation, the profiling operation executes independently of the instructions that are executed on the PE.

INRNSL A DSB instruction guarantees that all memory transactions that are made by the PE are observable by writes made by a profiling operation relating to a sampled operation in program order after the DSB instruction.

INDWCG

AContext Synchronization event guarantees that a direct write to a System register made by the PE in program order before the Context synchronization event are observable by indirect reads and indirect writes of the same System register made by a profiling operation relating to a sampled operation in program order after the Context synchronization event.

RTRDTK

To synchronize previous profiling operations, software must execute a PSB Buffer Synchronization instruction.

Note

The PSB CSYNC instruction is not defined in the AArch32 instruction set architecture.

IMLGHW

Following a Context synchronization event, a PSB instruction is guaranteed to synchronize the profiling operations for all instructions that are executed in program order before the Context synchronization event.

Synchronized by the PSB instruction means:

- Adirect read of a System register in program order following a PSB instruction requires explicit synchronization to observe an indirect write to the same System register made by a profiling operation synchronized by the PSB instruction.

- An indirect write to a System register made by a profiling operation synchronized by a PSB instruction does not affect a direct write to the same System register made in program order following the PSB instruction.

- Adirect write to a System register in program order following a PSB instruction is not allowed to affect an indirect read of the same System register made by a profiling operation synchronized by the PSB instruction.

- A DSB instruction in program order following a PSB instruction does not complete before the writes to the Profiling Buffer of sample records for profiling operations synchronized by the PSB instruction have completed. The DSB instruction must apply to both loads and stores.

For the indirect write to PMBSR\_ELx that is made as a result of an External abort on a write of a sample record to memory, the synchronization rules apply only after the write has completed. Completion of the write includes reporting any Profiling Buffer management event due to an Alignment fault or MMU fault.

Note

If profiling is not disabled when the Context synchronization event occurs, further profiling operations might be generated that are not guaranteed to be synchronized by the PSB instruction.

If the PE takes an exception to an Exception level where profiling is disabled, no new operations are selected for sampling. Profiling is always disabled if the owning Exception level is a lower Exception level than the current Exception level.

IVKDVF

In the absence of a Context synchronization event, a PSB instruction is not required to execute in program order with respect to sampled operations.

## D17.9.1 UNPREDICTABLE behavior

RPVRNK

In the absence of correct Context synchronization events, it is UNPREDICTABLE whether an indirect read of a System register made by a profiling operation will return the old or the new values.

RSXWCP

If the indirect reads mean that ProfilingBufferEnabled() returns FALSE when a sample record or records are about to be written to memory, then it is further CONSTRAINED UNPREDICTABLE whether the sample record or records:

- Are written to memory.
- Are silently discarded and not written to memory.
- Are discarded and not written to memory, and an Access Not Allowed Profiling Buffer management event is generated.
- RVCYWL If SCR\_EL3.{NSE, NS} does not match the owning Security state, then it is CONSTRAINED UNPREDICTABLE whether the sample record or records:
- Are written to memory using an address formed using the identity of the owning translation regime.
- Are written to memory using an address formed using the Effective values of SCR\_EL3.{NSE, NS}.
- Are silently discarded and not written to memory.
- Are discarded and not written to memory, and an Access Not Allowed Profiling Buffer management event is generated.
- RQJWVQ When FEAT\_RME is implemented and MDCR\_EL3.{NSPB,NSPBE} selects a reserved value, then it is CONSTRAINED UNPREDICTABLE whether the sample record or records:
- Are written to memory using an address formed using any implemented Security state.
- Are silently discarded and not written to memory.
- Are discarded and not written to memory, and an Access Not Allowed Profiling Buffer management event is generated.

IPDDCL Software must execute a PSB instruction to force any sample records to be written to the Profiling Buffer before changing context.

## Chapter D18 Statistical Profiling Extension Sample Record

## Specification

This chapter describes the sample records generated by the Statistical Profiling Extension. It contains the following sections:

- About the Statistical Profiling Extension sample records.
- Alphabetical list of Statistical Profiling Extension packets.