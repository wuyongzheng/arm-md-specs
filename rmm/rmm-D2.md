## Chapter D2 Realm shared memory protocol

This section describes a protocol for management of memory which is shared between a Realm and the Host. This protocol makes use of the primitives described in this specification. However, the protocol itself is not part of the RMMarchitecture. Use of this protocol is subject to a contract between the Realm and Host software agents.

See also:

- Chapter A5 Realm memory management

## D2.1 Realm shared memory protocol description

The Host agrees to provide the Realm with a certain amount of memory. This memory is referred to below as the Realm's 'memory footprint'.

The memory footprint is described to the Realm, for example via firmware tables. The Realm can choose, at any point during its execution, how much of its memory footprint is protected (accessible only to the Realm) and how much is shared with the Host.

Realm software treats the most significant IPA bit as a 'protection attribute' bit. This means that for every Protected IPA (in which the most significant bit is '0' ), there exists a corresponding Unprotected IPA alias, which is generated by setting the most significant bit to '1' .

The choice of whether a given page is protected or shared at a given time is expressed by setting the RIPAS of the Protected IPA:

- If the RIPAS of the Protected IPA is RAM, the page is protected and access to the Unprotected IPA alias causes a Synchronous External Abort taken to the Realm.
- If the RIPAS of the Protected IPA is EMPTY, the page is shared and access to the Unprotected IPA alias does not cause a Synchronous External Abort taken to the Realm.

The initial RIPAS for every page in the Realm's memory footprint is described to the Realm, for example via firmware tables. The Host agrees that during Realm execution, it will accept a RIPAS change request on any page within the Realm's memory footprint.

See also:

- A5.2.1 Realm IPA space
- A5.2.2 Realm IPA state
- A5.4 RIPAS change

## D2.2 Realm shared memory protocol flow

The following diagram illustrates how the protocol is used to set up and tear down a shared memory buffer.

Chapter D2. Realm shared memory protocol D2.2. Realm shared memory protocol flow

<!-- image -->

Figure D2.1: Realm shared memory protocol flow

## See also:

- D1.5.3 RIPAS change flow